#!/usr/bin/env node

const { spawn } = require('child_process');
const path = require('path');
const fs = require('fs');

function findBinary() {
  // First try the downloaded binary
  const downloadedBinary = path.join(__dirname, 'cadence-codegen');
  if (fs.existsSync(downloadedBinary)) {
    return downloadedBinary;
  }
  
  // Fallback to system PATH
  return 'cadence-codegen';
}

function main() {
  const binary = findBinary();
  const args = process.argv.slice(2);
  
  const child = spawn(binary, args, {
    stdio: 'inherit',
    windowsHide: false,
  });
  
  child.on('error', (error) => {
    if (error.code === 'ENOENT') {
      console.error('❌ cadence-codegen binary not found.');
      console.error('Please run: npm install');
      process.exit(1);
    } else {
      console.error('Error executing cadence-codegen:', error.message);
      process.exit(1);
    }
  });
  
  child.on('exit', (code, signal) => {
    if (signal) {
      process.kill(process.pid, signal);
    } else {
      process.exit(code || 0);
    }
  });
}

if (require.main === module) {
  main();
}